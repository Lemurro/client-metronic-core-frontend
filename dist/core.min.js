var bootstrap={};bootstrap.settings={},bootstrap.sessionID="",bootstrap.lightajax={},bootstrap.init=function(t){bootstrap.settings=Object.assign({onLoad:function(t){}},t),bootstrap._bindJSerrors(),bootstrap.lightajax=new LightAjax({callbackAlert:function(t,e){swal(t,e,"error")},ajax:{beforeSend:function(t,e){/^(HEAD|OPTIONS|TRACE)$/i.test(e.type)||t.setRequestHeader("X-SESSION-ID",bootstrap.sessionID)}}}),bootstrap._bindPhoneMask(),bootstrap._bindCodeMask(),bootstrap._bindSelect2(),localforage.getItem("sessionID",function(t,e){bootstrap.sessionID=e,auth.check()})},bootstrap._bindCodeMask=function(){$(".js-code-mask").each(function(){var t=$(this);Inputmask({mask:"9999"}).mask(t)})},bootstrap._bindJSerrors=function(){function t(t,e,r,o,a){var s="JSON not found";window.JSON&&(s=JSON.stringify(a)),"object"==typeof t&&(e=t.filename,r=t.lineno,o=t.colno,s=t.error.stack,t=t.message),(new Image).src=pathServerAPI+"jserrors?msg="+encodeURIComponent(t)+"&file="+encodeURIComponent(e)+"&line="+encodeURIComponent(r)+"&col="+encodeURIComponent(o)+"&err="+encodeURIComponent(s)}window.addEventListener?window.addEventListener("error",t,!1):window.attachEvent?window.attachEvent("onerror",t):window.onerror=t},bootstrap._bindPhoneMask=function(){$(".js-phone-mask").each(function(){var t=$(this);Inputmask({mask:"+7 (999) 999-99-99"}).mask(t)})},bootstrap._bindSelect2=function(){$(".js-select2").each(function(){$(this).select2({language:"ru",placeholder:"Выберите из списка"})})},bootstrap.authScreen=function(t){var e=$("#js-auth");"show"===t?($("#js-auth__get-form").show(),$("#js-auth__check-form").hide(),e.find('input[type="text"]').val(""),e.modal({backdrop:"static",keyboard:!1})):e.modal("hide")},bootstrap.initPage=function(){bootstrap.lightajax.get(!1,pathServerAPI+"user",{},function(t){if(t.hasOwnProperty("errors"))bootstrap.showErrors(t.errors);else{if(t.data.admin)$("#m_header_menu").find(".js-role").show();else for(var e in t.data.roles)t.data.roles[e].indexOf("read")!==-1&&$("#m_header_menu").find(".js-role__"+e).show();bootstrap.settings.onLoad(t.data);var r=$("#js-page");if(r.length>0){var o=window[r.attr("data-page")];void 0!==o&&o.hasOwnProperty("init")&&o.init()}}})},bootstrap.showErrors=function(t){if(1===t.length&&"401 Unauthorized"===t[0].status)bootstrap.authScreen("show");else if(1===t.length&&"403 Forbidden"===t[0].status){var e=!0;t[0].hasOwnProperty("meta")&&t[0].meta.hasOwnProperty("redirect")&&(e=t[0].meta.redirect),e?location.assign(location.origin+"/403"):bootstrap._showError(t[0].code,t[0].title)}else for(var r in t)bootstrap._showError(t[r].code,t[r].title)},bootstrap._showError=function(t,e){var r="Неизвестная ошибка",o="error";switch(t){case"danger":o="error",r="Критическая ошибка";break;case"warning":o="warning",r="Внимание!";break;case"info":o="info",r="Информация"}swal(r,e,o)};var auth={};auth._timerID=null,auth._runTimer=function(){null!==auth._timerID&&clearInterval(auth._timerID),auth._timerID=setInterval(function(){var t=$("#js-auth__check-form"),e=t.find(".js-timer__count"),r=parseInt(e.text(),10);r>0?e.text(--r):(clearInterval(auth._timerID),t.find(".js-timer").hide(),t.find(".js-resend").show())},1e3)},auth.check=function(){bootstrap.lightajax.get(!1,pathServerAPI+"auth/check",{},function(t){t.hasOwnProperty("errors")?bootstrap.showErrors(t.errors):($(".js-user__auth-id").text(t.data.user.auth_id),bootstrap.initPage())})},auth.checkCode=function(){var t=bowser.getParser(window.navigator.userAgent);bootstrap.lightajax.post(!0,pathServerAPI+"auth/code",{auth_id:$("#js-auth__get-form").find('input[name="auth_id"]').val(),auth_code:$("#js-auth__check-form").find('input[name="auth_code"]').val(),device_info:{uuid:"WebApp",platform:t.parsedResult.os.name,version:t.parsedResult.os.version,manufacturer:t.parsedResult.browser.name,model:t.parsedResult.browser.version}},function(t){bootstrap.lightajax.preloader("hide"),t.hasOwnProperty("errors")?($("#js-auth__check-form").find('input[name="auth_code"]').val(""),bootstrap.showErrors(t.errors)):localforage.setItem("sessionID",t.data.session,function(){bootstrap.sessionID=t.data.session,bootstrap.authScreen("hide"),auth.check()})})},auth.getCode=function(){bootstrap.lightajax.get(!0,pathServerAPI+"auth/code",{auth_id:$("#js-auth__get-form").find('input[name="auth_id"]').val()},function(t){if(bootstrap.lightajax.preloader("hide"),t.hasOwnProperty("errors"))bootstrap.showErrors(t.errors);else{t.data.hasOwnProperty("message")&&console.log(t.data.message,"AuthCode");var e=$("#js-auth__check-form");e.find(".js-timer").show(),e.find(".js-timer__count").text("60"),e.find(".js-resend").hide(),auth._runTimer(),$("#js-auth__get-form").hide(),e.show()}})},auth.logout=function(){helper.showConfirm("Выход","Вы действительно хотите выйти из системы?","Да","Нет",null,null,function(){$(".js-user-data").html('<i class="fas fa-spinner fa-pulse"></i>'),localforage.clear(),bootstrap.sessionID="",bootstrap.authScreen("show")},null)};var helper={};helper.clearFields=function(t){t.find('input[type="text"],input[type="password"],input[type="email"],input[type="number"],input[type="tel"],input[type="url"],input[type="date"],input[type="time"]').val(""),t.find("textarea").val(""),t.find("select").each(function(){$(this).val(null).trigger("change")}),t.find('input[type="checkbox"]').each(function(){$(this).prop("checked",!1)}),t.find('input[type="radio"]').each(function(){$(this).prop("checked",!1)})},helper.showConfirm=function(t,e,r,o,a,s,n,i){swal({title:t,html:e,type:"",allowOutsideClick:!1,showCancelButton:!0,confirmButtonText:r,cancelButtonText:o,onOpen:a,preConfirm:s}).then(function(t){t.value?n():null!==i&&i()})};var guide={};guide.init=function(){guide.type=$("#js-page").attr("data-type"),guide.templates={item:Template7.compile($("#js-tpl-guide__item").html())},guide._getData()},guide._getData=function(){bootstrap.lightajax.get(!0,pathServerAPI+"guide/"+guide.type,{},function(t){if(bootstrap.lightajax.preloader("hide"),t.hasOwnProperty("errors"))bootstrap.showErrors(t.errors);else{if($("#js-guide__loader").hide(),0===t.data.count)$("#js-guide__empty").show();else{var e="";for(var r in t.data.items)e+=guide.templates.item(t.data.items[r]);$("#js-guide__items").html(e),$("#js-guide__list").show()}void 0!==t.data.js_class&&window.hasOwnProperty(t.data.js_class)&&window[t.data.js_class].hasOwnProperty("init")&&window[t.data.js_class].init()}})},guide.edit=function(t,e){bootstrap.lightajax.get(!0,pathServerAPI+"guide/"+guide.type+"/"+t,{},function(r){if(bootstrap.lightajax.preloader("hide"),r.hasOwnProperty("errors"))bootstrap.showErrors(r.errors);else{var o=$("#js-guide-form");o.attr("data-id",t),o.find(".js-title").text("Редактирование записи"),$("#js-guide__button-insert").hide(),$("#js-guide__button-save").show(),$("#js-tab-form-button").html('<i class="fas fa-pencil-alt"></i> Редактировать'),tabs.tabInsertEdit("show"),e(r)}})},guide.insert=function(t,e){bootstrap.lightajax.post(!0,pathServerAPI+"guide/"+guide.type,{data:t},function(t){bootstrap.lightajax.preloader("hide"),t.hasOwnProperty("errors")?bootstrap.showErrors(t.errors):e(t)})},guide.remove=function(t,e,r){swal({title:"Удаление записи",html:'Вы хотите удалить <strong>"'+e+'"</strong>?',type:"warning",showCancelButton:!0,confirmButtonText:"Да, удалить!",cancelButtonText:"Отмена"}).then(function(e){e.value&&bootstrap.lightajax.post(!0,pathServerAPI+"guide/"+guide.type+"/"+t+"/remove",{},function(t){bootstrap.lightajax.preloader("hide"),t.hasOwnProperty("errors")?bootstrap.showErrors(t.errors):r(t)})})},guide.save=function(t,e){bootstrap.lightajax.post(!0,pathServerAPI+"guide/"+guide.type+"/"+t.id,{data:t},function(t){bootstrap.lightajax.preloader("hide"),t.hasOwnProperty("errors")?bootstrap.showErrors(t.errors):e(t)})},guide.showInsertForm=function(t){var e=$("#js-guide-form");e.attr("data-id","0"),e.find(".js-title").text("Добавление записи"),helper.clearFields(e),$("#js-guide__button-insert").show(),$("#js-guide__button-save").hide(),$("#js-tab-form-button").html('<i class="fas fa-plus"></i> Добавить'),tabs.tabInsertEdit("show"),t()};var tabs={};tabs.showTab=function(t){var e=$("#js-tabs__links"),r=$("#js-tabs__contents");e.find(".nav-link").removeClass("active show"),r.find(".tab-pane").removeClass("active show"),e.find('a[data-target="#'+t+'"]').addClass("active show"),r.find("#"+t).addClass("active show")},tabs.tabInsertEdit=function(t){var e=$("#js-tabs__links"),r=$("#js-tabs__contents");"show"===t?(e.find('a[data-target="#tab-form"]').parent().show(),r.find("#tab-form").addClass("active show"),tabs.showTab("tab-form")):(e.find('a[data-target="#tab-form"]').parent().hide(),r.find("#tab-form").removeClass("active show"),tabs.showTab("tab-list"))};var usersCore={};usersCore.edit=function(t,e){bootstrap.lightajax.get(!0,pathServerAPI+"users/"+t,{},function(r){if(bootstrap.lightajax.preloader("hide"),r.hasOwnProperty("errors"))bootstrap.showErrors(r.errors);else{var o=$("#js-user-form");o.attr("data-id",t),o.find(".js-title").text("Редактирование пользователя"),$("#js-user__button-insert").hide(),$("#js-user__button-save").show(),$("#js-tab-form-button").html('<i class="fas fa-pencil-alt"></i> Редактировать'),tabs.tabInsertEdit("show"),e(r)}})},usersCore.getData=function(){bootstrap.lightajax.get(!0,pathServerAPI+"users",{},function(t){if(bootstrap.lightajax.preloader("hide"),t.hasOwnProperty("errors"))bootstrap.showErrors(t.errors);else{var e="";for(var r in t.data.items)e+=users.templates.item(t.data.items[r]);$("#js-users__items").html(e)}})},usersCore.insert=function(t,e){bootstrap.lightajax.post(!0,pathServerAPI+"users",{data:t},function(t){bootstrap.lightajax.preloader("hide"),t.hasOwnProperty("errors")?bootstrap.showErrors(t.errors):e(t)})},usersCore.remove=function(t,e,r){swal({title:"Удаление пользователя",html:'Вы хотите удалить <strong>"'+e+'"</strong>?',type:"warning",showCancelButton:!0,confirmButtonText:"Да, удалить!",cancelButtonText:"Отмена"}).then(function(e){e.value&&bootstrap.lightajax.post(!0,pathServerAPI+"users/"+t+"/remove",{},function(t){bootstrap.lightajax.preloader("hide"),t.hasOwnProperty("errors")?bootstrap.showErrors(t.errors):r(t)})})},usersCore.save=function(t,e){bootstrap.lightajax.post(!0,pathServerAPI+"users/"+t.id,{data:t},function(t){bootstrap.lightajax.preloader("hide"),t.hasOwnProperty("errors")?bootstrap.showErrors(t.errors):e(t)})},usersCore.showInsertForm=function(t){var e=$("#js-user-form");e.attr("data-id","0"),e.find(".js-title").text("Добавление пользователя"),helper.clearFields(e),$("#js-user__button-insert").show(),$("#js-user__button-save").hide(),$("#js-tab-form-button").html('<i class="fas fa-plus"></i> Добавить'),tabs.tabInsertEdit("show"),t()};